-- return {
--   "neovim/nvim-lspconfig",
--   opts = {
--     inlay_hints = { enabled = false },
--     servers = {
--       bacon_ls = {
--         -- Keep the enabled condition
--         enabled = diagnostics == "bacon-ls",
--         -- Remove the capabilities function from here
--       },
--       rust_analyzer = { enabled = false },
--       -- Add other servers here if needed
--     },
--     -- Add a setup function to modify capabilities before server start
--     setup = {
--       bacon_ls = function(_, server_opts)
--         -- Create the basic capabilities table
--         local capabilities = vim.lsp.protocol.make_client_capabilities()
--         -- Set the desired position encoding
--         capabilities.general.positionEncodings = { "utf-8" }
--
--         -- Merge our capabilities with the existing ones provided by mason-lspconfig/cmp
--         -- 'force' ensures our setting overrides any default
--         server_opts.capabilities = vim.tbl_deep_extend("force", server_opts.capabilities or {}, capabilities)
--
--         -- Return false to let the default nvim-lspconfig setup function run
--         -- with the modified server_opts.
--         return false
--       end,
--     },
--   },
-- }
return {
  "neovim/nvim-lspconfig",
  opts = {
    inlay_hints = { enabled = false },
    servers = {
      bacon_ls = {
        enabled = diagnostics == "bacon-ls",
      },
      rust_analyzer = { enabled = false },
    },
  },
}
